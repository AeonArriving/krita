From 722b36065e6f9f3ec0a35c0576aca00b0129e216 Mon Sep 17 00:00:00 2001
From: "L. E. Segovia" <amy@amyspark.me>
Date: Sat, 19 Nov 2022 00:52:06 +0000
Subject: [PATCH 19/20] meson: fix incorrect ELF macro addition

---
 meson.build                       | 1 +
 source/tools/toolutil/meson.build | 7 +++----
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/meson.build b/meson.build
index bf8cd6b..4a83256 100644
--- a/meson.build
+++ b/meson.build
@@ -12,6 +12,7 @@ PACKAGE_ICU_DESCRIPTION = 'International Components for Unicode'
 PACKAGE_ICU_URL = 'http://icu-project.org'
 
 cpp = meson.get_compiler('cpp')
+have_elf_h = cpp.has_header('elf.h')
 
 if host_machine.system() == 'windows'
   add_project_arguments('-DU_PLATFORM_USES_ONLY_WIN32_API', language: 'cpp')
diff --git a/source/tools/toolutil/meson.build b/source/tools/toolutil/meson.build
index ed0e279..82101cb 100644
--- a/source/tools/toolutil/meson.build
+++ b/source/tools/toolutil/meson.build
@@ -28,12 +28,11 @@ sources = files(
 toolutil_c_args = ['-DU_TOOLUTIL_IMPLEMENTATION']
 toolutil_cpp_args = ['-DU_TOOLUTIL_IMPLEMENTATION']
 
-if host_machine.system() != 'windows' and host_machine.system() != 'darwin'
-  toolutil_c_args += ['-DU_ELF']
-  toolutil_cpp_args += ['-DU_ELF']
+if have_elf_h
+  toolutil_c_args += ['-DU_HAVE_ELF_H']
+  toolutil_cpp_args += ['-DU_HAVE_ELF_H']
 endif
 
-
 toolutil_lib = library(
   'toolutil',
   sources,
-- 
2.38.1

