From ab3deed5199bc064f45971dc0d77761a294c59cc Mon Sep 17 00:00:00 2001
From: "L. E. Segovia" <amy@amyspark.me>
Date: Wed, 16 Nov 2022 19:28:23 -0300
Subject: [PATCH 07/18] meson: Add soversion to prevent system lookup issues

---
 meson.build                 | 2 ++
 source/common/meson.build   | 1 +
 source/i18n/meson.build     | 1 +
 source/io/meson.build       | 1 +
 source/layoutex/meson.build | 1 +
 source/stubdata/meson.build | 1 +
 6 files changed, 7 insertions(+)

diff --git a/meson.build b/meson.build
index e02a6fa..25459bb 100644
--- a/meson.build
+++ b/meson.build
@@ -7,6 +7,8 @@ project(
   default_options: 'cpp_std=c++17',
 )
 
+U_ICU_VERSION = meson.project_version()
+
 cpp = meson.get_compiler('cpp')
 
 if host_machine.system() == 'windows'
diff --git a/source/common/meson.build b/source/common/meson.build
index c4d30aa..fbeba17 100644
--- a/source/common/meson.build
+++ b/source/common/meson.build
@@ -208,6 +208,7 @@ common_lib = library(
   cpp_args: '-DU_COMMON_IMPLEMENTATION',
   link_whole: stubdata_lib,
   dependencies: dl_dep,
+  version: U_ICU_VERSION,
 )
 
 icuuc_dep = declare_dependency(
diff --git a/source/i18n/meson.build b/source/i18n/meson.build
index 8a52c11..edd79b1 100644
--- a/source/i18n/meson.build
+++ b/source/i18n/meson.build
@@ -271,6 +271,7 @@ i18n_lib = library(
   link_with: [common_lib],
   c_args: '-DU_I18N_IMPLEMENTATION',
   cpp_args: '-DU_I18N_IMPLEMENTATION',
+  version: U_ICU_VERSION,
 )
 
 icui18n_dep = declare_dependency(
diff --git a/source/io/meson.build b/source/io/meson.build
index 52cc44f..bb4f441 100644
--- a/source/io/meson.build
+++ b/source/io/meson.build
@@ -27,6 +27,7 @@ io_lib = library(
   c_args: '-DU_IO_IMPLEMENTATION',
   cpp_args: '-DU_IO_IMPLEMENTATION',
   link_with: [i18n_lib, common_lib],
+  version: U_ICU_VERSION,
 )
 
 icuio_dep = declare_dependency(
diff --git a/source/layoutex/meson.build b/source/layoutex/meson.build
index 0ea8dac..479798f 100644
--- a/source/layoutex/meson.build
+++ b/source/layoutex/meson.build
@@ -22,4 +22,5 @@ layoutex = library(
   c_args: '-DU_LAYOUTEX_IMPLEMENTATION',
   cpp_args: '-DU_LAYOUTEX_IMPLEMENTATION',
   link_with: [common_lib],
+  version: U_ICU_VERSION,
 )
diff --git a/source/stubdata/meson.build b/source/stubdata/meson.build
index d5cf1d3..f0586b7 100644
--- a/source/stubdata/meson.build
+++ b/source/stubdata/meson.build
@@ -13,4 +13,5 @@ stubdata_lib = library(
   'stubdata',
   sources,
   include_directories: incdir,
+  version: U_ICU_VERSION,
 )
-- 
2.37.1.windows.1

