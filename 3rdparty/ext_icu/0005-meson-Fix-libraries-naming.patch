From a1fc48cb39d79a5dbb34ef85ae03e6727e2ab46a Mon Sep 17 00:00:00 2001
From: "L. E. Segovia" <amy@amyspark.me>
Date: Wed, 16 Nov 2022 19:21:36 -0300
Subject: [PATCH 05/18] meson: Fix libraries naming

---
 meson.build                 | 14 ++++++++++++++
 source/common/meson.build   |  4 +++-
 source/i18n/meson.build     |  8 +++++++-
 source/layoutex/meson.build |  4 +++-
 4 files changed, 27 insertions(+), 3 deletions(-)

diff --git a/meson.build b/meson.build
index 5d9071e..7f85e3a 100644
--- a/meson.build
+++ b/meson.build
@@ -34,6 +34,20 @@ if get_option('default_library') == 'static'
   add_project_arguments('-DU_STATIC_IMPLEMENTATION', language: 'c')
   add_project_arguments('-DU_STATIC_IMPLEMENTATION', language: 'cpp')
   usage_args = ['-DU_STATIC_IMPLEMENTATION']
+  if host_machine.system() == 'windows' and cpp.get_argument_syntax() == 'msvc'
+    library_prefix = ''
+    library_suffix = ''
+  else
+    library_prefix = 's'
+    if get_option('buildtype') == 'debug'
+      library_suffix = 'd'
+    else
+      library_suffix = ''
+    endif
+  endif
+else
+  library_prefix = ''
+  library_suffix = ''
 endif
 
 subdir('source')
diff --git a/source/common/meson.build b/source/common/meson.build
index e0ceae1..55910b1 100644
--- a/source/common/meson.build
+++ b/source/common/meson.build
@@ -191,8 +191,10 @@ sources = files(
   'wintz.cpp',
 )
 
+icuuc_name = '@0@icuuc@1@'.format(library_prefix, library_suffix)
+
 common_lib = library(
-  'uc',
+  icuuc_name,
   sources,
   include_directories: incdir,
   c_args: '-DU_COMMON_IMPLEMENTATION',
diff --git a/source/i18n/meson.build b/source/i18n/meson.build
index f449475..8dd96ba 100644
--- a/source/i18n/meson.build
+++ b/source/i18n/meson.build
@@ -251,8 +251,14 @@ sources = files(
   #  'filteredbrk.cpp',
 )
 
+if host_machine.system() == 'windows'
+  i18n_name = '@0@icuin@1@'.format(library_prefix, library_suffix)
+else
+  i18n_name = '@0@icui18n@1@'.format(library_prefix, library_suffix)
+endif
+
 i18n_lib = library(
-  'icui18n',
+  i18n_name,
   sources,
   include_directories: incdir,
   link_with: [common_lib],
diff --git a/source/layoutex/meson.build b/source/layoutex/meson.build
index 497ac54..79ab723 100644
--- a/source/layoutex/meson.build
+++ b/source/layoutex/meson.build
@@ -6,8 +6,10 @@ sources = files(
   'plruns.cpp',
 )
 
+layoutex_name = '@0@lx@1@'.format(library_prefix, library_suffix)
+
 layoutex = library(
-  'layoutex',
+  layoutex_name,
   sources,
   include_directories: [incdir, include_directories('..')],
   c_args: '-DU_LAYOUTEX_IMPLEMENTATION',
-- 
2.37.1.windows.1

