From dbc371d50fef432ae51e8218e8a6675cc72ad52b Mon Sep 17 00:00:00 2001
From: Dmitry Kazakov <dimula73@gmail.com>
Date: Thu, 23 Mar 2023 14:15:23 +0100
Subject: [PATCH] Fix GPerf to compile with C++17

---
 .../GPERF-Make-the-code-CPP17-compilant.patch | 48 +++++++++++++++++++
 subprojects/gperf.wrap                        |  1 +
 2 files changed, 49 insertions(+)
 create mode 100644 subprojects/GPERF-Make-the-code-CPP17-compilant.patch
diff --git a/subprojects/packagefiles/GPERF-Make-the-code-CPP17-compilant.patch b/subprojects/packagefiles/GPERF-Make-the-code-CPP17-compilant.patch
new file mode 100644
index 0000000..4ffb1c1
--- /dev/null
+++ b/subprojects/packagefiles/GPERF-Make-the-code-CPP17-compilant.patch
@@ -0,0 +1,13 @@
+diff --git a/lib/getline.cc b/lib/getline.cc
+index ecc3e85..2d97644 100644
+--- a/lib/getline.cc
++++ b/lib/getline.cc
+@@ -55,7 +55,7 @@ getstr (char **lineptr, size_t *n, FILE *stream, char terminator, size_t offset)
+ 
+   for (;;)
+     {
+-      register int c = getc (stream);
++      int c = getc (stream);
+ 
+       /* We always want at least one char left in the buffer, since we
+          always (unless we get an error while reading the first char)
+-- 
+2.17.1
+
diff --git a/subprojects/gperf.wrap b/subprojects/gperf.wrap
index d8014e0..3f5dcdb 100644
--- a/subprojects/gperf.wrap
+++ b/subprojects/gperf.wrap
@@ -3,6 +3,7 @@ directory=gperf
 url=https://gitlab.freedesktop.org/tpm/gperf.git
 push-url=https://gitlab.freedesktop.org/tpm/gperf.git
 revision=meson
+diff_files=GPERF-Make-the-code-CPP17-compilant.patch
 
 [provide]
 program_names=gperf
-- 
2.38.1.windows.1

